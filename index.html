<!DOCTYPE html>
<html>
<head>
 <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VMF33S0Y6X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VMF33S0Y6X');
</script>   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marksheet Analysis - VIII-S-40</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); padding: 30px; }
        h1 { text-align: center; color: #0056b3; margin-bottom: 25px; font-size: 28px; font-weight: 600; }
        
        /* Stats styles (upgraded) */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 5px solid #007bff; text-align: left; }
        .stat-val { font-size: 32px; font-weight: 700; color: #007bff; }
        .stat-lbl { font-size: 14px; color: #555; margin-top: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat:nth-child(2) .stat-val { color: #28a745; }
        .stat:nth-child(2) .border-left { border-color: #28a745; }
        .stat:nth-child(3) .stat-val { color: #dc3545; }
        .stat:nth-child(3) .border-left { border-color: #dc3545; }

        /* Controls styles */
        .controls { margin-bottom: 20px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        input[type="text"], select { 
            padding: 10px 14px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            font-size: 14px; 
            flex: 1; 
            min-width: 200px;
        }
        button { 
            padding: 10px 20px; 
            background: #28a745; 
            color: #fff; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px;
            transition: background 0.2s ease;
        }
        button:hover { background: #218838; }
        button.export { background: #007bff; }
        button.export:hover { background: #0056b3; }

        /* Table styles */
        .tbl-wrap { overflow-x: auto; width: 100%; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 20px; }
        thead { background: #007bff; color: #fff; position: sticky; top: 0; z-index: 10; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; white-space: nowrap; }
        th { font-weight: 600; }
        tbody tr:hover { background: #f1f8ff; }
        
        /* Ranks and conditional styles */
        .rank-1 { background: #d4edda !important; font-weight: 600; }
        .rank-2 { background: #d1ecf1 !important; }
        .rank-3 { background: #fff3cd !important; }
        .pct { color: #007bff; font-weight: 700; }
        .total { font-weight: 700; color: #333; }
        .lost { color: #dc3545; font-weight: 600; }
        
        .section-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 12px;
            display: inline-block;
        }
        .super-40 { background: #d4edda; color: #155724; }
        .star-40 { background: #fff3cd; color: #856404; }
        .na { background: #f8d7da; color: #721c24; }

    </style>
</head>
<body>
    <div class="container">
        <h1>游늵 Marksheet Analysis - VIII-S-40</h1>
        
        <div class="stats" id="stats-container">
            <!-- Stats will be loaded by JS -->
        </div>
        
        <div class="controls">
            <input type="text" id="search-box" placeholder="Search by Admission No or Name..." onkeyup="renderTable()">
            <select id="sort-select" onchange="applySort()">
                <option value="pct-desc">Sort by % (Desc)</option>
                <option value="pct-asc">Sort by % (Asc)</option>
                <option value="total-desc">Sort by Total (Desc)</option>
                <option value="admn-asc">Sort by Admn No (Asc)</option>
            </select>
            <button class="export" onclick="exportToCSV()">游닌 Export CSV</button>
        </div>
        
        <div class="tbl-wrap">
            <table id="marks-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Admn No</th>
                        <th>Name</th>
                        <th>Section</th>
                        <th>INMT (1080)</th>
                        <th>PT (240)</th>
                        <th>JEE M (900)</th>
                        <th>JEE A (180)</th>
                        <th>EAPCET (160)</th>
                        <th class="total">Total (2260)</th>
                        <th class="pct">%</th>
                        <th>Lost</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Data will be loaded by JS -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
// --- VITAL DATA ---

// 1. MAX MARKS (As per user confirmation)
const MAX_MARKS = {
    INMT: 1080,  // 9 exams * 120 marks (Updated for INMT-8)
    PT: 240,    // 2 exams * 120 marks
    JEEM: 900,
    JEEA: 180,
    EAP: 160
};
const GRAND_TOTAL_MAX = MAX_MARKS.INMT + MAX_MARKS.PT + MAX_MARKS.JEEM + MAX_MARKS.JEEA + MAX_MARKS.EAP; // 1840

// 2. STUDENT NAMES (82 students from SLOTS (1).pdf)
const studentNames = {
    4363: "NAINA DODLA", 4404: "SIDVIK NARLA", 4460: "SAI THANVI KUTHADI", 4526: "MULA SIRI CHANDANA REDDY", 4562: "MANDA SAKSHAR SHUBHAN",
    6617: "Thota Sanvi Reddy", 6640: "Dasari Pranav", 13091: "SWARGAM JOSHIKA", 14044: "ATHARV PANCHARIYA", 14045: "VISHWA TEJA RANGOJI",
    14110: "NAYAN REDDY LOKA", 14123: "VYSHNAVI SURA", 14212: "SAINI SAI SMARANI", 14275: "BILLA AKSHITHA VARMA", 14335: "BOLLAM SAI HARSHITH",
    14343: "PATHEM GO풒풏풐품", 14361: "MOSAM SNEHITHA", 14377: "BETHI SIRI CHANDANA", 14470: "CHOUDARY AKHEERANANDAN", 14627: "PERUKA SAHASRA",
    14889: "JAKKULA SAI SPOORTHY", 14902: "GADAM ANIRUDH", 14915: "NEERUMALLA VINAYAK", 14934: "ALLALA ARADHYA REDDY", 14987: "JAGIRI MANIRUDH DHEVANSH",
    25412: "MALYALA RISHWITH TEJAV", 25415: "JINNARAPU ABHIGNA", 25436: "PAIDA ARADHYA", 25477: "NANNAPARAJU ADDHYYA", 25503: "MEESALA ADHYA",
    25528: "GUNDA ANUHYA", 25541: "NADIMETLA AKHIL", 25641: "KOMMERA SREEPADHA REDDY", 25659: "풒품NALI BANOTHU", 25668: "RAMASAHAYAM RUDRA JAYAWANTH",
    130050: "풒풋KALA HARSHITH", 130072: "ABHINAV CHUNCHU", 130086: "KRUTHIK RAJ BARKAM", 130092: "HARSHASRI PAMULA", 130169: "SIRI VARSHINI RACHAKONDA",
    130231: "RISHI CHANDRAN NAMPELLY", 130531: "SUNKARI KARTHIKA ANSHU", 130681: "AKSHARA BANDA", 4352: "MOKSHA APPALA", 4361: "SHIVEN REDDY METHUKULA",
    4371: "KRISHNA CHAITANYA SRI PERUMBUDUR", 4378: "RUHAN YAMSANI", 4542: "VURUMADLA SAI ARADHYA", 4565: "MOTURI AMITH VARDHAN",
    6611: "Erra Likhith Kumar", 6612: "Nadipelly Saharsh", 6663: "Rachakonda Reyansh Patel", 14041: "VISHWESHWAR GAJJELA",
    14046: "SHIV SMARAN REDDY ONTELA", 14152: "SUHAAS ERUKULLA", 14356: "RAMANCHA SUCHARITHA", 14436: "SIRIPURAM RAHUL SIDDHARTHA",
    14512: "BURRA LAASYA", 14525: "KAKIRALA VISHWADATH", 14706: "MUSTYALA SHRIYANS", 14855: "UGRAPU PRANEETH KUMAR", 14882: "NAGULA ANIRUDH",
    14905: "CHITTETI SRIJAN REDDY", 14909: "SUNKARI SRI HARSHINI", 14917: "GURRALA SHRAVYA", 14950: "CHEERLA THANVI SRI",
    14957: "풐품풗KOJVALA SAHAS TEJ", 25427: "JALAGAM MANVITH RAO", 25446: "SHANIGARAPU SHRESHTA", 25525: "SINGI REDDY GOUTHAM REDDY",
    25536: "POPURI REETHIKA", 25537: "풐품풓THALA SUMEETH REDDY", 25577: "RAGI SAI SUDIKSHA", 25598: "PINGILY MANUSHWITH REDDY",
    130016: "MUDUGANTI ANANYA REDDY", 130023: "SUNIRMAL CHANDRA BEDARAKOTA", 130046: "KOTHA NITHYA VAMSHIKA", 130229: "HEMANTH CHINDAM",
    130285: "SRI KRUTHIKA PATI", 130367: "SAI VARSHITH KATUKURI", 130412: "SAANVI PATEL SIDDENKI", 130413: "VAISHVIK SUBBANI"
};

// 3. STUDENT SECTIONS (from SLOTS (1).pdf)
const studentSections = {
    4363: "STAR40", 4404: "STAR40", 4460: "STAR40", 4526: "STAR40", 4562: "STAR40", 6617: "STAR40", 6640: "STAR40", 13091: "STAR40",
    14044: "STAR40", 14045: "STAR40", 14110: "STAR40", 14123: "STAR40", 14212: "STAR40", 14275: "STAR40", 14335: "STAR40", 14343: "STAR40",
    14361: "STAR40", 14377: "STAR40", 14470: "STAR40", 14627: "STAR40", 14889: "STAR40", 14902: "STAR40", 14915: "STAR40", 14934: "STAR40",
    14987: "STAR40", 25412: "STAR40", 25415: "STAR40", 25436: "STAR40", 25477: "STAR40", 25503: "STAR40", 25528: "STAR40", 25541: "STAR40",
    25641: "STAR40", 25659: "STAR40", 25668: "STAR40", 130050: "STAR40", 130072: "STAR40", 130086: "STAR40", 130092: "STAR40",
    130169: "STAR40", 130231: "STAR40", 130531: "STAR40", 130681: "STAR40", 4352: "SUPER40", 4361: "SUPER40", 4371: "SUPER40",
    4378: "SUPER40", 4542: "SUPER40", 4565: "SUPER40", 6611: "SUPER40", 6612: "SUPER40", 6663: "SUPER40", 14041: "SUPER40",
    14046: "SUPER40", 14152: "SUPER40", 14356: "SUPER40", 14436: "SUPER40", 14512: "SUPER40", 14525: "SUPER40", 14706: "SUPER40",
    14855: "SUPER40", 14882: "SUPER40", 14905: "SUPER40", 14909: "SUPER40", 14917: "SUPER40", 14950: "SUPER40", 14957: "SUPER40",
    25427: "SUPER40", 25446: "SUPER40", 25525: "SUPER40", 25536: "SUPER40", 25537: "SUPER40", 25577: "SUPER40", 25598: "SUPER40",
    130016: "SUPER40", 130023: "SUPER40", 130046: "SUPER40", 130229: "SUPER40", 130285: "SUPER40", 130367: "SUPER40",
    130412: "SUPER40", 130413: "SUPER40"
};

// 4. RAW SCORES (from all 13 PDFs)
// "AB" or missing scores are treated as 0
const allData = {
    inmt0: {4378: 111, 4352: 110, 6612: 110, 14152: 106, 25598: 106, 4565: 106, 14525: 105, 25536: 105, 4371: 105, 4542: 100, 14046: 97, 130367: 95, 14436: 95, 4361: 95, 6611: 95, 14044: 91, 130412: 90, 14512: 90, 130016: 89, 14356: 86, 14041: 85, 14123: 85, 14987: 85, 4404: 85, 14882: 83, 14905: 82, 6663: 80, 14706: 78, 14212: 77, 25641: 77, 25577: 76, 14902: 75, 130046: 75, 14950: 75, 25528: 75, 14045: 74, 14917: 74, 130285: 73, 14335: 73, 6640: 72, 6617: 71, 130086: 70, 14343: 70, 25537: 70, 130092: 68, 130072: 67, 130229: 67, 130413: 67, 14275: 66, 14377: 64, 14889: 64, 14855: 60, 25659: 60, 14957: 59, 25446: 58, 130023: 55, 25427: 54, 130050: 51, 14909: 51, 14110: 50, 4526: 46, 14934: 45, 25668: 43, 4562: 43, 4460: 40, 130169: 39, 130231: 35, 25412: 34, 130531: 31, 25436: 26, 14627: 25, 13091: 0, 25415: 0, 25477: 0, 14470: 0, 25525: 0},
    inmt1: {4371: 120, 14152: 115, 4361: 115, 25598: 112, 14041: 110, 4565: 110, 6611: 110, 4352: 106, 14356: 105, 14882: 105, 4378: 105, 6617: 103, 14046: 102, 25536: 100, 14909: 97, 14525: 96, 25537: 96, 14436: 95, 14044: 91, 14905: 91, 6612: 91, 14706: 90, 14470: 90, 14950: 90, 4542: 90, 14889: 89, 25525: 89, 14512: 86, 130016: 85, 14917: 84, 14377: 83, 25659: 81, 130412: 81, 130023: 80, 130367: 80, 25528: 80, 130413: 77, 130285: 76, 130231: 75, 130086: 74, 14361: 74, 14335: 73, 6640: 73, 130531: 71, 130072: 70, 14855: 70, 25577: 69, 14045: 64, 14110: 62, 25641: 62, 14957: 61, 130229: 60, 14123: 60, 25412: 60, 25668: 59, 4460: 58, 25427: 57, 130050: 54, 6663: 53, 14902: 52, 4404: 52, 14627: 51, 14275: 50, 130169: 48, 14343: 48, 25477: 47, 130092: 44, 14212: 44, 14934: 42, 4562: 40, 25436: 39, 4363: 39, 25446: 38, 4526: 33, 25415: 18, 13091: 0, 14987: 0, 130046: 0},
    inmt2: {6612: 110, 130367: 101, 4378: 101, 14152: 100, 14525: 100, 14436: 97, 130412: 95, 4361: 95, 4371: 95, 25598: 93, 4542: 92, 14950: 91, 4352: 89, 25536: 87, 14041: 86, 14045: 86, 14909: 82, 25577: 82, 14356: 80, 4565: 78, 25446: 77, 130413: 76, 14855: 75, 14046: 75, 25537: 75, 14905: 74, 14917: 73, 4460: 72, 14470: 72, 14512: 72, 25525: 72, 6611: 70, 130231: 68, 130016: 67, 130046: 67, 25427: 66, 14044: 64, 14957: 64, 130285: 63, 14343: 63, 14706: 63, 14889: 63, 6617: 61, 130072: 60, 14934: 60, 4404: 60, 4363: 59, 14882: 58, 4526: 57, 14123: 55, 14361: 55, 130086: 54, 14335: 54, 130229: 53, 6663: 53, 130023: 52, 130050: 51, 14110: 50, 130531: 49, 14212: 49, 14902: 48, 13091: 45, 25528: 45, 25641: 44, 25668: 41, 14627: 41, 130092: 40, 25659: 38, 6640: 38, 14275: 38, 130169: 34, 14377: 34, 25412: 34, 25477: 32, 25415: 31, 14987: 30, 25436: 27, 4562: 13},
    inmt3: {6611: 120, 14152: 110, 4361: 110, 4371: 110, 25598: 108, 4378: 107, 130046: 105, 25525: 102, 4565: 102, 14525: 100, 130412: 97, 14917: 97, 4352: 97, 4542: 97, 14957: 96, 25536: 96, 130367: 91, 14905: 91, 6612: 90, 130413: 88, 14512: 87, 25446: 87, 14950: 86, 130229: 83, 25427: 83, 14436: 81, 14855: 80, 14356: 80, 6663: 79, 6617: 78, 14909: 77, 14361: 76, 25577: 74, 130285: 73, 25528: 72, 13091: 70, 14044: 70, 14934: 70, 25537: 70, 130072: 69, 14889: 69, 4460: 68, 14882: 68, 130016: 67, 14212: 66, 14123: 65, 130023: 64, 14706: 64, 14046: 64, 4404: 64, 130050: 63, 14470: 63, 14041: 61, 14343: 60, 14275: 60, 25659: 59, 6640: 59, 14335: 58, 130086: 55, 14045: 53, 25668: 51, 14110: 49, 14987: 45, 4526: 45, 25641: 44, 4363: 43, 130092: 42, 25541: 42, 25503: 41, 130169: 40, 4562: 40, 130531: 38, 25477: 37, 25415: 36, 14902: 34, 14377: 0, 14627: 0},
    inmt4: {14525: 107, 4361: 105, 6612: 105, 25536: 103, 14905: 102, 4371: 100, 4378: 100, 14152: 93, 14882: 93, 130367: 90, 14950: 90, 4352: 90, 6611: 90, 14917: 88, 4542: 88, 4565: 87, 14046: 86, 25525: 86, 14356: 85, 130231: 84, 14706: 83, 14335: 78, 6617: 78, 130016: 76, 130046: 76, 25427: 76, 25537: 75, 25528: 71, 130412: 71, 14512: 71, 130072: 70, 14855: 70, 130229: 67, 14045: 66, 130413: 65, 130023: 64, 14889: 63, 6640: 63, 14044: 62, 14361: 62, 25412: 62, 14987: 60, 14041: 60, 14212: 59, 6663: 59, 14470: 58, 25446: 57, 14110: 56, 14275: 55, 14909: 55, 14377: 54, 14902: 54, 130531: 53, 130169: 51, 4404: 51, 130285: 51, 13091: 45, 4460: 44, 25503: 43, 25659: 42, 14934: 40, 14343: 39, 130681: 38, 4526: 38, 25668: 37, 130050: 35, 130092: 35, 4562: 35, 25415: 33, 4363: 23, 14627: 21, 25436: 7, 25541: 0, 25598: 0},
    inmt5: {14905: 116, 130367: 115, 130412: 115, 25598: 115, 4371: 115, 6612: 115, 14046: 111, 14152: 111, 25536: 111, 4378: 110, 4542: 110, 14525: 106, 4352: 106, 14950: 105, 25525: 105, 4361: 105, 25577: 102, 14212: 101, 14512: 101, 130072: 100, 6617: 100, 4565: 100, 14915: 99, 130531: 99, 6640: 99, 14045: 97, 130016: 96, 130231: 95, 25427: 95, 6611: 95, 14917: 93, 14110: 92, 14275: 92, 14889: 91, 14470: 91, 14377: 90, 130046: 90, 14356: 90, 14436: 90, 14909: 90, 4404: 89, 4363: 88, 130092: 88, 14335: 88, 14361: 87, 25668: 87, 14882: 87, 6663: 87, 25528: 86, 130413: 86, 14041: 86, 14957: 86, 13091: 85, 25477: 85, 14855: 85, 130050: 84, 130023: 84, 25503: 83, 25446: 82, 14343: 81, 14934: 80, 130681: 79, 130229: 79, 25541: 74, 25436: 74, 130086: 73, 130285: 73, 14706: 73, 25537: 73, 4526: 71, 14627: 70, 130169: 68, 14044: 67, 4460: 67, 25641: 67, 14123: 65, 25412: 65, 14902: 58, 25659: 57, 4562: 40, 14987: 0, 25415: 0},
    inmt6: {4361: 110, 6612: 110, 25536: 107, 4565: 106, 130367: 105, 14915: 103, 130046: 100, 14152: 100, 25598: 97, 4378: 97, 14525: 96, 6617: 95, 4542: 95, 14902: 94, 130231: 93, 130072: 90, 130412: 90, 14917: 90, 14044: 88, 4352: 88, 14046: 87, 14957: 86, 130092: 85, 14212: 85, 4371: 85, 14470: 83, 25525: 83, 14436: 82, 130285: 81, 14934: 80, 4404: 80, 130016: 80, 130413: 80, 14512: 76, 6640: 75, 14356: 75, 14889: 74, 130681: 73, 14335: 72, 14343: 71, 14855: 71, 14110: 70, 25477: 70, 25577: 70, 25503: 68, 130050: 67, 14909: 67, 25537: 66, 130023: 65, 14950: 65, 6611: 65, 130531: 64, 14377: 62, 14905: 62, 25446: 62, 4562: 61, 25427: 59, 14045: 58, 25412: 58, 25541: 58, 4363: 57, 14123: 56, 14987: 56, 130229: 56, 130086: 55, 25641: 53, 25668: 53, 6663: 52, 25659: 51, 130169: 49, 14706: 49, 4460: 48, 14627: 45, 25436: 45, 14041: 40, 25415: 39, 4526: 26, 13091: 0, 14275: 0, 14361: 0, 25528: 0, 14882: 0},
    inmt7: {130412: 120, 130413: 115, 14041: 115, 14046: 115, 14525: 115, 25536: 115, 25598: 115, 4361: 115, 4371: 115, 4378: 115, 14905: 111, 14152: 110, 4352: 107, 130681: 106, 4542: 106, 130046: 105, 130367: 105, 6611: 105, 6612: 105, 130016: 101, 14950: 100, 4565: 100, 130072: 97, 14110: 97, 25525: 96, 14045: 95, 14915: 94, 14356: 94, 6617: 92, 25577: 92, 14343: 91, 25537: 91, 130231: 90, 13091: 90, 25477: 90, 25503: 90, 14917: 90, 14957: 90, 130092: 88, 14470: 88, 14512: 87, 14706: 87, 14987: 86, 25641: 86, 25659: 86, 4562: 83, 14436: 82, 6640: 81, 130229: 80, 14902: 79, 14335: 78, 14889: 78, 4404: 78, 25427: 78, 130050: 75, 14212: 75, 14627: 75, 130285: 75, 14377: 74, 25541: 74, 4460: 74, 14044: 73, 14361: 73, 25528: 71, 14934: 70, 14123: 70, 25668: 69, 14909: 69, 25446: 68, 6663: 66, 14275: 65, 130023: 65, 25436: 60, 14855: 60, 25412: 50, 4526: 50, 130086: 47, 4363: 40, 130169: 39, 130531: 0, 25415: 0, 14882: 0},
     inmt8: {25536: 115, 25598: 115, 14046: 111, 25577: 111, 130367: 110, 14152: 110, 14905: 110, 6611: 110, 14706: 107, 14909: 106, 4542: 106, 130231: 105, 130412: 105, 14889: 105, 4371: 105, 4565: 105, 14915: 102, 4378: 102, 25525: 101, 25477: 100, 130046: 100, 4361: 100, 6612: 100, 14335: 99, 130072: 98, 14525: 95, 4352: 95, 14044: 94, 14470: 93, 14110: 92, 14957: 92, 14917: 91, 25446: 91, 25528: 91, 130681: 90, 14356: 90, 14950: 90, 25537: 90, 25541: 88, 6617: 86, 25427: 84, 14436: 83, 25503: 82, 14512: 81, 130285: 80, 130413: 80, 14627: 80, 130531: 79, 130086: 78, 6663: 78, 14343: 77, 13091: 75, 14041: 75, 14361: 75, 130016: 75, 14045: 74, 14377: 72, 130050: 72, 130023: 69, 25415: 69, 14882: 67, 14855: 65, 4404: 64, 25668: 63, 25641: 62, 25659: 62, 130092: 61, 130169: 61, 14275: 59, 130229: 57, 14902: 57, 4363: 57, 14123: 55, 4526: 55, 6640: 51, 14934: 51, 25436: 48, 4562: 38, 25412: 37, 14987: 0, 4460: 0, 14212: 0},
 pt1: {14525: 119, 25536: 119, 4361: 119, 130046: 118.5, 130412: 118.5, 14152: 118.5, 4542: 118.5, 14957: 118, 25577: 118, 4352: 118, 4565: 118, 6663: 118, 14335: 117.5, 14917: 117.5, 14046: 117, 14905: 117, 25598: 117, 4371: 117, 6611: 117, 130016: 116.5, 130367: 116.5, 14909: 116.5, 14950: 116.5, 130072: 116, 130086: 116, 14512: 116, 14361: 115, 14212: 115, 14882: 115, 4378: 115, 6617: 115, 130285: 114.5, 14275: 114.5, 25525: 114.5, 130231: 114, 14044: 114, 14356: 114, 14436: 114, 25528: 114, 4404: 114, 14706: 113.5, 14889: 113.5, 13091: 112.5, 14934: 112.5, 25641: 112.5, 130023: 112, 14343: 112, 14902: 112, 25503: 112, 130229: 111.5, 130169: 111, 130531: 111, 14045: 111, 14110: 110, 14987: 110, 25412: 110, 4460: 110, 25415: 109.5, 130092: 109, 14377: 109, 14470: 108.5, 25446: 108.5, 25537: 108.5, 25477: 108.5, 25659: 108.5, 25427: 108, 6612: 107.5, 14123: 107, 25668: 106, 4526: 106, 14855: 105.5, 130050: 104.5, 25436: 103.5, 4562: 102.5, 130413: 102, 6640: 102, 14627: 101.5, 4363: 99.5, 14041: 97.5, 25541: 95.5, 130681: 0},
    pt2: {4352: 119.5, 130412: 119, 4565: 118.5, 130046: 118, 14525: 118, 14905: 118, 14917: 118, 25598: 118, 130016: 117.5, 25536: 117.5, 4361: 117.5, 4378: 117.5, 130092: 117, 14335: 117, 14915: 117, 25577: 117, 4542: 117, 14046: 116.5, 14706: 116.5, 14045: 116, 25503: 116, 14152: 116, 14909: 116, 25525: 116, 130231: 115.5, 14361: 115.5, 130367: 115.5, 14950: 115.5, 4371: 115.5, 14470: 115, 130531: 114.5, 14212: 114.5, 25641: 114.5, 25446: 114.5, 6611: 114.5, 4404: 114, 6617: 114, 14343: 113.5, 25412: 113.5, 6612: 113.5, 130681: 113, 130086: 113, 14987: 113, 14356: 113, 130285: 112.5, 14377: 111.5, 25477: 111.5, 25528: 111.5, 25659: 111.5, 14275: 111, 130072: 110.5, 4562: 110.5, 25537: 110.5, 14934: 110, 25668: 110, 6640: 110, 14512: 110, 130050: 109.5, 14889: 109.5, 25415: 109.5, 14902: 109, 14957: 109, 13091: 108.5, 14044: 108.5, 4460: 108.5, 14110: 107.5, 14123: 107.5, 14627: 106.5, 14436: 106.5, 4526: 106, 25427: 105.5, 130169: 105.5, 130023: 105, 6663: 104.5, 25541: 97.5, 14855: 95.5, 4363: 93, 130413: 88.5, 130229: 88, 14041: 87.5, 14882: 68.5, 25436: 0},
    jeemain: {14525: 271, 4361: 266, 4565: 255, 14152: 249, 25598: 248, 25525: 235, 6612: 235, 14046: 232, 4371: 229, 6611: 227, 130016: 225, 25536: 225, 4352: 224, 130367: 223, 130046: 222, 4378: 222, 14882: 220, 4542: 220, 25537: 212, 14356: 209, 14950: 208, 14957: 199, 14706: 195, 14917: 193, 25446: 192, 14905: 190, 130285: 188, 130412: 184, 14045: 180, 14855: 180, 130231: 178, 130023: 175, 14041: 175, 25577: 175, 25427: 171, 14436: 171, 6663: 170, 130086: 169, 14110: 169, 14335: 168, 14343: 168, 130229: 166, 14909: 165, 14512: 163, 130050: 159, 4460: 158, 14361: 157, 14275: 157, 25528: 153, 14212: 151, 14377: 150, 14934: 149, 6617: 148, 130413: 147, 130072: 145, 25641: 145, 130092: 141, 13091: 141, 130531: 140, 14044: 139, 14470: 137, 14902: 134, 14123: 133, 14987: 133, 25659: 132, 4404: 128, 4363: 125, 25412: 124, 25668: 123, 6640: 118, 25477: 115, 4526: 112, 14889: 110, 130169: 91, 25436: 75, 4562: 67, 25503: 50, 25415: 0, 14627: 0, 130681: 0, 14915: 0, 25541: 0},
    jeemain2: {25598: 278, 4371: 271, 4361: 270, 130367: 266, 4378: 265, 4565: 261, 14046: 259, 6612: 257, 14152: 256, 130412: 250, 4542: 250, 130046: 248, 14525: 247, 14915: 237, 25446: 232, 4352: 232, 25525: 231, 25536: 231, 6611: 227, 14044: 220, 14212: 215, 130072: 214, 130016: 214, 130231: 212, 14436: 212, 14110: 209, 14335: 208, 25503: 207, 14905: 207, 25577: 201, 14950: 200, 130229: 199, 14909: 199, 25427: 198, 14855: 196, 6663: 195, 14512: 194, 4404: 194, 130023: 192, 6617: 192, 130050: 189, 130285: 187, 14045: 186, 130169: 184, 14987: 184, 14470: 184, 4460: 181, 14706: 181, 130681: 180, 130413: 180, 14957: 179, 25668: 178, 14377: 177, 25477: 177, 14917: 176, 14356: 175, 14275: 174, 6640: 164, 14889: 163, 25415: 160, 13091: 157, 14902: 157, 130086: 154, 14627: 153, 25537: 153, 25528: 150, 14934: 149, 25659: 149, 25412: 146, 4363: 144, 25641: 142, 130092: 139, 14123: 136, 25541: 135, 14041: 132, 14343: 130, 14361: 122, 25436: 106, 4562: 70, 130531: 0, 14882: 0, 4526: 0}, 
jeemain3 = {14152: 275, 25536: 270, 4361: 270, 6612: 267, 25598: 265, 14525: 264, 130367: 261, 4371: 253, 4378: 250, 4565: 249, 4542: 247, 130046: 243, 25577: 243, 130231: 230, 14046: 230, 14436: 230, 6611: 225, 130412: 223, 25537: 223, 4352: 223, 130016: 222, 14905: 221, 130072: 220, 130413: 219, 14356: 219, 14110: 212, 14706: 211, 14950: 211, 130050: 210, 14915: 208, 25541: 206, 14909: 204, 14855: 202, 14512: 199, 130023: 192, 14917: 192, 4404: 191, 25446: 189, 14889: 188, 25477: 187, 14335: 186, 14987: 184, 25641: 183, 25659: 183, 130092: 182, 25427: 182, 14627: 180, 14343: 178, 14957: 178, 6640: 178, 14041: 177, 130285: 176, 25503: 176, 14212: 174, 130229: 173, 14044: 171, 14045: 170, 25668: 168, 14470: 167, 25525: 166, 130086: 165, 14882: 165, 6617: 164, 130681: 162, 14361: 161, 14123: 151, 25415: 151, 25412: 150, 14275: 141, 4363: 134, 6663: 132, 130169: 128, 25436: 122, 14377: 114, 14934: 110, 14902: 105, 130531: 104, 4460: 95, 4526: 88, 4562: 77, 13091: 0, 25528: 0},
 jeeadv: {4371: 174, 4378: 164, 25598: 160, 14525: 158, 25536: 154, 6612: 154, 6611: 152, 25525: 150, 4361: 149, 4565: 149, 130046: 148, 14152: 148, 14905: 146, 14046: 144, 4352: 132, 4542: 130, 130229: 128, 14356: 128, 14706: 124, 14882: 124, 130367: 123, 14470: 121, 14917: 120, 14212: 117, 14275: 117, 6617: 117, 14950: 117, 130050: 115, 130412: 114, 14436: 114, 14909: 110, 14889: 109, 25577: 109, 14123: 108, 25446: 105, 14987: 104, 130016: 104, 25427: 104, 130023: 103, 14855: 103, 25537: 103, 25528: 101, 6640: 101, 6663: 101, 14045: 92, 14110: 92, 25668: 92, 25477: 90, 25541: 88, 130285: 88, 14343: 87, 14934: 87, 14512: 87, 130231: 86, 130413: 86, 14335: 85, 25503: 85, 14377: 84, 130072: 82, 4404: 80, 130681: 79, 4460: 78, 25641: 76, 14957: 73, 130092: 72, 4363: 71, 14044: 68, 14361: 67, 14627: 67, 14041: 66, 130086: 63, 13091: 59, 130169: 57, 14902: 55, 4562: 47, 25436: 44, 25415: 40, 130531: 0, 25412: 0, 25659: 0, 4526: 0, 14915: 0},
    eapcet: {130046: 150, 4361: 149, 14152: 146, 25598: 144, 130016: 143, 25536: 142, 4371: 142, 6612: 142, 14046: 138, 14525: 138, 14915: 136, 4352: 136, 14905: 135, 6611: 135, 130412: 134, 14436: 134, 4378: 134, 4565: 134, 14855: 131, 6617: 130, 14212: 126, 14909: 125, 130681: 124, 130231: 124, 14045: 124, 130367: 123, 25525: 122, 130072: 121, 14934: 121, 14335: 120, 14706: 120, 14950: 120, 130050: 119, 6640: 118, 25537: 118, 130092: 117, 14361: 117, 130413: 117, 4542: 117, 25415: 116, 25528: 116, 130285: 116, 14512: 116, 25577: 116, 130531: 115, 14044: 115, 4460: 114, 14356: 114, 14889: 112, 25641: 112, 14470: 111, 25541: 111, 14110: 110, 25503: 109, 25427: 109, 25446: 108, 130229: 107, 14957: 107, 6663: 107, 130023: 106, 14123: 103, 14627: 103, 14343: 102, 13091: 101, 25477: 101, 25659: 99, 130169: 98, 4404: 97, 14377: 96, 14275: 95, 14917: 95, 25412: 92, 25668: 91, 130086: 90, 14041: 89, 4526: 89, 4363: 88, 25436: 83, 14902: 81, 4562: 81, 14987: 0, 14882: 0}
};

// --- LOGIC ---

// Global array for student data
let studentMetrics = [];

// Helper to get score, returns 0 if AB/null/undefined
function getScore(obj, key) {
    return Number(obj?.[key]) || 0;
}

/**
 * Calculates all student metrics from raw data
 */
function calculateMetrics() {
    studentMetrics = [];
    // Added "inmt8" to the list below
    const inmtKeys = ["inmt0", "inmt1", "inmt2", "inmt3", "inmt4", "inmt5", "inmt6", "inmt7", "inmt8"];

    // ... rest of the function remains the same ...

    // We only iterate over the students present in the name file
    for (const admnNo of Object.keys(studentNames)) {
        
        // 1. Calculate INMT Total
        let inmtTotal = 0;
        for (const key of inmtKeys) {
            inmtTotal += getScore(allData[key], admnNo);
        }

        // 2. Calculate PT Total
        const pt1 = getScore(allData.pt1, admnNo);
        const pt2 = getScore(allData.pt2, admnNo);
        const ptTotal = pt1 + pt2;

        // 3. Get other scores
        const jeeM = getScore(allData.jeemain, admnNo) + getScore(allData.jeemain2, admnNo) + getScore(allData.jeemain3, admnNo);
        const jeeA = getScore(allData.jeeadv, admnNo);
        const eap = getScore(allData.eapcet, admnNo);

        // 4. Calculate Grand Total
        const grandTotal = inmtTotal + ptTotal + jeeM + jeeA + eap;

        // 5. Calculate Percentage
        const percentage = (grandTotal / GRAND_TOTAL_MAX) * 100;

        // 6. Calculate Lost Marks
        const lost = GRAND_TOTAL_MAX - grandTotal;

        // 7. Push to global array
        studentMetrics.push({
            admn: admnNo,
            name: studentNames[admnNo],
            section: studentSections[admnNo] || "N/A",
            inmt: inmtTotal,
            pt: ptTotal,
            jeeM: jeeM,
            jeeA: jeeA,
            eap: eap,
            total: grandTotal,
            pct: percentage,
            lost: lost
        });
    }
}

/**
 * Renders the statistics cards
 */
function renderStats(dataToRender) {
    const statsContainer = document.getElementById("stats-container");
    if (!dataToRender.length) {
        statsContainer.innerHTML = "<p>No data to display.</p>";
        return;
    }

    // Sort by percentage for topper
    const sortedForStats = [...dataToRender].sort((a, b) => b.pct - a.pct);
    const topper = sortedForStats[0];

    // Calculate Average %
    const avgPct = (dataToRender.reduce((sum, s) => sum + s.pct, 0) / dataToRender.length).toFixed(2);
    
    statsContainer.innerHTML = `
        <div class="stat">
            <div class="stat-val">${dataToRender.length}</div>
            <div class="stat-lbl">Students (Filtered)</div>
        </div>
        <div class="stat">
            <div class="stat-val">${avgPct}%</div>
            <div class="stat-lbl">Average %</div>
        </div>
        <div class="stat">
            <div class="stat-val" style="font-size: 24px;">${topper.name}</div>
            <div class="stat-lbl">Topper: ${topper.pct.toFixed(2)}%</div>
        </div>
    `;
}

/**
 * Renders the main data table
 */
function renderTable() {
    const tableBody = document.getElementById("table-body");
    const searchQuery = document.getElementById("search-box").value.toLowerCase();

    // 1. Filter data
    const filteredData = studentMetrics.filter(s => {
        return s.admn.includes(searchQuery) || s.name.toLowerCase().includes(searchQuery);
    });

    // 2. Sort data (using the global sorted array)
    const sortedData = applySort(filteredData); // applySort will sort and return the data

    // 3. Render Stats
    renderStats(sortedData);

    // 4. Render Table
    tableBody.innerHTML = ""; // Clear existing table
    if (sortedData.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="12" style="text-align: center; padding: 20px; color: #777;">No students found matching your search.</td></tr>`;
        return;
    }

    sortedData.forEach((student, index) => {
        const tr = document.createElement("tr");

        // Add rank classes
        if (index === 0) tr.classList.add("rank-1");
        if (index === 1) tr.classList.add("rank-2");
        if (index === 2) tr.classList.add("rank-3");
        
        // Section tag
        let sectionClass = "na";
        if (student.section === "SUPER40") sectionClass = "super-40";
        if (student.section === "STAR40") sectionClass = "star-40";
        
        tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${student.admn}</td>
            <td>${student.name}</td>
            <td><span class="section-tag ${sectionClass}">${student.section}</span></td>
            <td>${student.inmt}</td>
            <td>${student.pt.toFixed(1)}</td>
            <td>${student.jeeM}</td>
            <td>${student.jeeA}</td>
            <td>${student.eap}</td>
            <td class="total">${student.total.toFixed(1)}</td>
            <td class="pct">${student.pct.toFixed(2)}%</td>
            <td class="lost">${student.lost.toFixed(1)}</td>
        `;
        tableBody.appendChild(tr);
    });
}

/**
 * Sorts the data based on the dropdown selection
 */
function applySort(data) {
    const sortValue = document.getElementById("sort-select").value;
    const dataToSort = data || studentMetrics; // Use provided data or the global list

    dataToSort.sort((a, b) => {
        switch (sortValue) {
            case "pct-asc":
                return a.pct - b.pct;
            case "total-desc":
                return b.total - a.total;
            case "admn-asc":
                return parseInt(a.admn) - parseInt(b.admn);
            case "pct-desc":
            default:
                return b.pct - a.pct;
        }
    });
    
    // If called by the onchange event, re-render the table
    if (!data) {
        renderTable();
    }
    
    return dataToSort; // Return the sorted data
}

/**
 * Exports the currently sorted/filtered view to CSV
 */
function exportToCSV() {
    const tableBody = document.getElementById("table-body");
    const header = "Rank,Admn No,Name,Section,INMT (960),PT (240),JEE M (300),JEE A (180),EAPCET (160),Total (1840),%,Lost Marks\n";
    
    let csvContent = header;

    // Get the currently rendered rows to export *exactly* what the user sees
    const rows = tableBody.querySelectorAll("tr");
    
    rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const rowData = Array.from(cells).map(cell => {
            // "Name" might have commas, so wrap it in quotes
            if (cell.cellIndex === 2) {
                return `"${cell.textContent}"`;
            }
            // Remove % sign from percentage
            if (cell.cellIndex === 10) {
                return cell.textContent.replace('%', '');
            }
            return cell.textContent;
        });
        csvContent += rowData.join(",") + "\n";
    });

    // Create and download the file
    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    link.setAttribute("href", url);
    link.setAttribute("download", "marksheet_analysis.csv");
    link.style.visibility = "hidden";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}


// --- INITIALIZATION ---
window.onload = () => {
    calculateMetrics(); // Process all the data
    applySort();        // Sort and render the table
};

    </script>
</body>
</html>
